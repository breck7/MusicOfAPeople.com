// Manually copy/pasted from catalog.scroll
const csv = `SongName,SongNameLink,Artist,ArtistLink,CoverImage,Mp3Name,Genre
LemonHead,index.html#LemonHead,Scotty2Yachty,https://www.youtube.com/watch?v=cjYDPGrfdDM,LemonHead,Lemonhead,Neu Metal
Enjoy the Silence - Samuele Scelfo Edit,index.html#Enjoy the Silence - Samuele Scelfo Edit,Unconventional,https://www.youtube.com/watch?v=xgcLwtGlgLU,EnjoyTheSilence,EnjoyTheSilence,alternative rock
No Plans,index.html#No Plans,Justin Ransom,https://www.youtube.com/watch?v=gWHx0x8KD0E,No Plans,No Plans,
Lofi Girl,index.html#Lofi Girl,David E Beats,https://www.youtube.com/watch?v=2mHgdptQaMY,Lofi Girl,Lofi girl,
Dreams,index.html#Dreams,Mr. Yohan,https://www.youtube.com/watch?v=6Pm1FVPA_T8,Dreams,Dreams,
Egypt,index.html#Egypt,Mr. Yohan,https://www.youtube.com/watch?v=RGwSak0n-Fw,Egypt,Egypt,
Nigeria,index.html#Nigeria,Mr. Yohan,https://www.youtube.com/watch?v=beXj_dRjT8Q,Nigeria,Nigeria,
Coffee Shop,index.html#Coffee Shop,Mr. Yohan,https://www.youtube.com/watch?v=Dk1AviaKr8c,Coffee Shop,Coffee Shop,
Crossfire,index.html#Crossfire,Stepehen,https://youtu.be/eH4F1Tdb040,Crossfire,Stephen - Crossfire,
Help Me Lose my mind (Mazde Remix),index.html#Help Me Lose my mind (Mazde Remix),Disclosure,https://soundcloud.com/mazde,Help-Me-lose-my-Mind,Disclosure - Help Me Lose My Mind (Mazde Remix),
Burning Alive,index.html#Burning Alive,8 Graves,https://soundcloud.com/8graves,Burning Alive,8 Graves - Burning Alive,
Cold Shoulder,index.html#Cold Shoulder,8 Graves,https://soundcloud.com/8graves,Cold Shoulder,8 Graves - Cold Shoulder,
I was Wrong,index.html#I was Wrong,A R I Z O N A,https://soundcloud.com/thisisarizonamusic,I was wrong,A R I Z O N A - I Was Wrong,
Trouble,index.html#Trouble,Adam Jensen,https://soundcloud.com/AdamJensenMusic,Trouble,Adam Jensen - Trouble,
Dreams (feat. ELEA),index.html#Dreams (feat. ELEA),Adventure Club,https://soundcloud.com/adventureclub,Dreams AdClub,Adventure Club - Dreams (feat. ELEA),
Wonder (feat. The Kite String Tangle),index.html#Wonder (feat. The Kite String Tangle),Adventure Club,https://soundcloud.com/adventureclub,Wonder,Adventure Club - Wonder (feat. The Kite String Tangle),
Rise & Fall,index.html#Rise & Fall,Adventure Club & Krewalla,https://soundcloud.com/adventureclub,Rise & Fall,Adventure Club & Krewella - Rise & Fall,
Dear Lillie,index.html#Dear Lillie,Aether,https://soundcloud.com/aetheraudio,Dear Lillie,Aether - Dear Lillie,
Fragments,index.html#Fragments,Aether,https://soundcloud.com/aetheraudio,Fragments,Aether - Fragments,
Tender,index.html#Tender,Aether,https://soundcloud.com/aetheraudio,Tender,Aether - Tender,
If I Killed Someone For You,index.html#If I Killed Someone For You,Alec Benjamin,https://soundcloud.com/alecbenjamin,Killed Someone,Alec Benjamin - If I Killed Someone For You,
Outrunning Karma,index.html#Outrunning Karma,Alec Benjamin,https://soundcloud.com/alecbenjamin,Outrunning Karma,Alec Benjamin - Outrunning Karma,
Paper Love,index.html#Paper Love,Allie X,https://soundcloud.com/alliexandra,Paper Love,Allie X - Paper Love,
You and I,index.html#You and I,ALOTT x Wankelmut x Enny-Mae,https://www.youtube.com/watch?v=xgcLwtGlgLU,You and I,ALOTT x Wankelmut x Enny-Mae - You and I,
If God Had A Boat,index.html#If God Had A Boat,ANYMA,https://www.anymamusic.com/,If God Had A Boat,ANYMA - If God Had A Boat,
Lord & Master,index.html#Lord & Master,Apashe,https://soundcloud.com/lindien,Lord & Master,Apashe - Lord & Master,
I don't know why,index.html#I don't know why,AVAION,https://www.instagram.com/avaiion/,I don't know why,AVAION - i don't know why,
Two Million,index.html#Two Million,Avicii,http://soundcloud.com/aviciiofficial,Two Million,Avicii - Two Million,
GRRRLS,index.html#GRRRLS,AViVA,https://fanlink.to/AViVAShop,GRRRLS,AViVA - GRRRLS,
Hypnotized,index.html#Hypnotized,AViVA,https://fanlink.to/AViVAShop,Hypnotized,AViVA - Hypnotized,
Nightmare,index.html#Nightmare,AViVA,https://fanlink.to/AViVAShop,Nightmares,AViVA - Nightmare,
Twisted,index.html#Twisted,AViVA,https://fanlink.to/AViVAShop,Twisted,AViVA - Twisted,
Ghostbox,index.html#Ghostbox,AWAY x Crywolf,https://soundcloud.com/awaynotfound,Ghostbox,AWAY x Crywolf - Ghostbox,
Rituals,index.html#Rituals,AWAY x Echoes,https://soundcloud.com/awaynotfound,Rituals,AWAY x Echos - Ritual,
Blossom,index.html#Blossom,Ben Walter,https://soundcloud.com/ben-walter-12,Blossom,Ben Walter - Blossom,
Between The Devil And The Deep Blue Sea,index.html#Between The Devil And The Deep Blue Sea,XYLØ,https://soundcloud.com/xylo100,Between The Devil And The Deep Blue Sea,XYLØ - Between The Devil And The Deep Blue Sea,
Ocean Eyes (Astronomyy Remix),index.html#Ocean Eyes (Astronomyy Remix),Billie Eilish,https://soundcloud.com/billieeilishsh,Ocean Eyes,Billie Eilish - Ocean Eyes (Astronomyy Remix),
Wings (Nu-Logic Remix),index.html#Wings (Nu-Logic Remix),Birdy,http://www.nulogicmusic.com/,Wings,Birdy - Wings (Nu-Logic Remix),
River,index.html#River,BISHOP,https://soundcloud.com/thatgirlbishop,River,BISHOP - River,
Wild Horses,index.html#Wild Horses,BISHOP,https://soundcloud.com/thatgirlbishop,Wild Horses,BISHOP - Wild Horses,
IDFC (Acoustic Version),index.html#IDFC (Acoustic Version),Blackbear,https://soundcloud.com/iamblackbear,IDFC,Blackbear - IDFC (Acoustic Version),
Raging On A Sunday,index.html#Raging On A Sunday,Bohnes,https://soundcloud.com/bohnesofficial,Raging On A Sunday,Bohnes - Raging On A Sunday,
Kingslayer,index.html#Kingslayer,Caster & Ironheart,https://soundcloud.com/casterscurse,Kingslayer,Caster & Ironheart - Kingslayer,
DOOM,index.html#DOOM,Calivania,https://soundcloud.com/calivania,DOOM,Calivania - DOOM,
Koto,index.html#Koto,CloZee,https://soundcloud.com/clozee,Koto,CloZee - Koto,
You're Not Alone,index.html#You're Not Alone,CMA,https://soundcloud.com/cma-music,You're Not Alone,CMA - You're Not Alone,
Midnight (Kygo Remix),index.html#Midnight (Kygo Remix),Coldplay,https://soundcloud.com/kygo,Midnight,Coldplay - Midnight (Kygo Remix),
Snowglobe,index.html#Snowglobe,Cozmoe,https://soundcloud.com/iamcozmoe,Snowglobe,cozmoe - Snowglobe,
we try,index.html#we try,Cozmoe,https://soundcloud.com/iamcozmoe,we try,cozmoe - we try,
Feel Like (feat. CAPPA),index.html#Feel Like (feat. CAPPA),Dabin,https://soundcloud.com/dabinlee,Feel Like,Dabin - Feel Like (feat. CAPPA),
Hold,index.html#Hold,Dabin,https://soundcloud.com/dabinlee,Hold,Dabin - Hold (feat. Daniela Andrade),
Holding On (feat. Lowell),index.html#Holding On (feat. Lowell),Dabin,https://soundcloud.com/dabinlee,Holding on,Dabin - Holding On (feat. Lowell),
Hope It Hurts (feat. Essenger),index.html#Hope It Hurts (feat. Essenger),Dabin,https://soundcloud.com/dabinlee,Hope It Hurts,Dabin - Hope It Hurts (feat. Essenger),
Remember (feat. Noelle Johnson),index.html#Remember (feat. Noelle Johnson),Dabin,https://soundcloud.com/dabinlee,Remember,Dabin - Remember (feat. Noelle Johnson),
The Take Down,index.html#The Take Down,Dabin & Koda,https://soundcloud.com/dabinlee,The Take Down,Dabin & Koda - The Take Down,
When This Is Over (feat. Donovan Woods),index.html#When This Is Over (feat. Donovan Woods),Dabin & Nurko,https://soundcloud.com/dabinlee,When this is over,Dabin & Nurko - When This Is Over (feat. Donovan Woods),
Again,index.html#Again,Dabin x MYRNE,https://soundcloud.com/dabinlee,Again,Dabin x MYRNE - Again,
Get Lucky (Razihel Remix),index.html#Get Lucky (Razihel Remix),Daft Punk,https://soundcloud.com/razihel,Get Lucky,Daft Punk - Get Lucky (Razihel Remix),
Self Control,index.html#Self Control,DallasK,https://soundcloud.com/dallask,Self Control,DallasK - Self Control,
i don't give a f**k about it,index.html#i don't give a f**k about it,DAMPSTATE,https://soundcloud.com/damp-state,I don't give,DAMPSTATE - i don't give a f**k about it,
0:59,index.html#0:59,DANGER,https://soundcloud.com/2emedanger,Danger,DANGER - 0-59,
Waking Up,index.html#Waking Up,Danny Olsen & Becca Krueger,https://linktr.ee/dannyolsonmusic,Waking Up,Danny Olson & Becca Krueger - Waking Up,
White Noise (feat. Ryder),index.html#White Noise (feat. Ryder),Danrell,https://soundcloud.com/danrell,White Noise,Danrell - White Noise (feat. Ryder),
Medicine (Sound Remedy Remix),index.html#Medicine (Sound Remedy Remix),Daughter,http://soundcloud.com/soundremedy,Medicine,Daughter - Medicine (Sound Remedy Remix),
All I Want (Manila Killa Remix),index.html#All I Want (Manila Killa Remix),Dawn Golden,https://soundcloud.com/manilakilla,All I Want,Dawn Golden - All I Want (Manila Killa Remix),
Stardust,index.html#Stardust,DNIE,https://soundcloud.com/dniemusic,Stardust,DNIE - Stardust,
Lost & Found (feat. Meggie York),index.html#Lost & Found (feat. Meggie York),Dreweybear,https://soundcloud.com/dreweybear/tracks,Lost & Found,Dreweybear - Lost & Found (feat. Meggie York),
Demons,index.html#Demons,DROELOE,https://soundcloud.com/droeloemusic,Demons,DROELOE - Demons,
Oath (TWO LANES REMIX),index.html#Oath (TWO LANES REMIX),DROELOE,https://soundcloud.com/droeloemusic,Oath,DROELOE - Oath (TWO LANES REMIX),
Panorama,index.html#Panorama,DROELOE,https://soundcloud.com/droeloemusic,Panorama,DROELOE - Panorama,
Boys Do Cry,index.html#Boys Do Cry,Dylan Matthew,https://soundcloud.com/itsdylanmatthew,Boys Do Cry,Dylan Matthew - Boys Do Cry,
Summer 16,index.html#Summer 16,Dylan Matthew,https://soundcloud.com/itsdylanmatthew,Summer 16,Dylan Matthew - Summer 16,
Wait For Us,index.html#Wait For Us,EBEN & Meggie York,https://soundcloud.com/ebenofficial,Wait For Us,EBEN & Meggie York - Wait For Us,
Love Story,index.html#Love Story,EBEN & Zack Gray,https://soundcloud.com/ebenofficial,Love Story,EBEN & Zack Gray - Love Story,
Crazy,index.html#Crazy,ECHOS,https://soundcloud.com/echosofficial,Crazy,Echos - Crazy,
Euphoria,index.html#Euphoria,ECHOS,https://soundcloud.com/echosofficial,Euphoria,Echos - Euphoria,
Guest Room,index.html#Guest Room,ECHOS,https://soundcloud.com/echosofficial,Guest Room,Echos - Guest Room,
King of Disappointment,index.html#King of Disappointment,ECHOS,https://soundcloud.com/echosofficial,King of Disappointment,Echos - King of Disappointment,
Saints,index.html#Saints,ECHOS,https://soundcloud.com/echosofficial,Saints,Echos - Saints,
Tomorrow (Kicks N Licks Remix),index.html#Tomorrow (Kicks N Licks Remix),ECHOS,https://soundcloud.com/echosofficial,Tomorrow,Echos - Tomorrow (Kicks N Licks Remix),
Vacant,index.html#Vacant,ECHOS,https://soundcloud.com/echosofficial,Vacant,Echos - Vacant,
Take,index.html#Take,ECHOS,https://soundcloud.com/echosofficial,Take,Echos - Take,
Gravity,index.html#Gravity,EDEN,https://soundcloud.com/iameden,Gravity,EDEN - Gravity,
Wake Up,index.html#Wake Up,EDEN,https://soundcloud.com/iameden,Wake Up,EDEN - Wake Up,
drugs,index.html#drugs,EDEN,https://soundcloud.com/iameden,drugs,EDEN - drugs,
XO,index.html#XO,EDEN,https://soundcloud.com/iameden,XO,EDEN - XO,
End Credits (feat. Leah Kelly),index.html#End Credits (feat. Leah Kelly),EDEN,https://soundcloud.com/iameden,End Credits,EDEN - End Credits (feat. Leah Kelly),
crash,index.html#crash,EDEN,https://soundcloud.com/iameden,crash,EDEN - crash,
Rock & Roll,index.html#Rock & Roll,EDEN,https://soundcloud.com/iameden,Rock & Roll,music name here - remember img must be in .mp3 formate and it's inside the songs folder of this project folder,
Drown (feat. Au/Ra),index.html#Drown (feat. Au/Ra),EKALI,https://soundcloud.com/ekalimusic/,Drown,Ekali - Drown (feat. Au-Ra),
Fairy Tale,index.html#Fairy Tale,Ekali & Elohim,https://soundcloud.com/ekalimusic/,Fairy Tale,Ekali & Elohim - Fairy Tale,
Pretty Little Gangster,index.html#Pretty Little Gangster,Ella Isaacson,www.ellaisaacson.com,Pretty Little Gangster,Ella Isaacson - Pretty Little Gangster,
Ruins,index.html#Ruins,Ella Isaacson,www.ellaisaacson.com,Ruins,Ella Isaacson - Ruins,
All On My Line,index.html#All On My Line,Revenue Hefner,,All-On-My-Line,All-On-My-Line,
Pushin On' Foot,index.html#Pushin On' Foot,Revenue Hefner,,Pushin-On-Foot,Pushin-On-Foot,
Lost Sky - Vision NCS,index.html#Lost Sky - Vision NCS,NCS Release,https://soundcloud.com/nocopyrightsounds/lost-sky-vision-ncs-release,Lost-Sky_Vision-NCS,Lost-Sky_Vision-NCS,
Jim - Sun Goes Down,index.html#Jim - Sun Goes Down,Jim Yosef x Roy,https://soundcloud.com/nocopyrightsounds/jim-yosef-x-roy-knox-sun-goes-down-ncs-release,Jim_Sun-Goes-Down,Jim_Sun-Goes-Down,
Hardwind - Want Me,index.html#Hardwind - Want Me,Mike Archangelo,https://www.youtube.com/watch?v=-Rw8zR9wmTY,Hardwind_Want-Me,Hardwind_Want-Me,
Harley Bird - Home,index.html#Harley Bird - Home,Jordan Schor,https://www.youtube.com/watch?v=zpJDrG6H2kg,Harley-Bird_Home,Harley-Bird_Home,
Ikson Anywhere – Ikson,index.html#Ikson Anywhere – Ikson,Audio Library,https://www.youtube.com/watch?v=zwPhqU29rWQ,Ikson-Anywhere_Ikson,Ikson-Anywhere_Ikson,
Beauz & Jvna - Crazy,index.html#Beauz & Jvna - Crazy,Beauz & Jvna,https://www.youtube.com/watch?v=xgcLwtGlgLU,Beauz&Jvna_Crazy,Beauz&Jvna_Crazy,`

const allMusic = TreeNode.fromCsv(csv).map((node) => node.toObject())

const wrapper = document.querySelector(".wrapper"),
  musicImg = wrapper.querySelector(".img-area img"),
  musicName = wrapper.querySelector(".song-details .name"),
  musicArtist = wrapper.querySelector(".song-details .artist"),
  playPauseBtn = wrapper.querySelector(".play-pause"),
  prevBtn = wrapper.querySelector("#prev"),
  nextBtn = wrapper.querySelector("#next"),
  mainAudio = wrapper.querySelector("#main-audio"),
  progressArea = wrapper.querySelector(".progress-area"),
  progressBar = progressArea.querySelector(".progress-bar"),
  favoriteMusicBtn = wrapper.querySelector("#favorite")

const localStorageKeys = {
  favorites: "favorites",
  playMode: "playMode",
}

let favorites = []
const initFavorites = () => {
  try {
    // Wrap in a try/catch in case someone's browser does not support local storage
    favorites =
      JSON.parse(localStorage.getItem(localStorageKeys.favorites)) ?? []
  } catch (err) {
    console.error("Error trying to load favorites from localStorage.", err)
  }
}
initFavorites()

const getStartSongIndex = () => {
  const startHash = decodeURIComponent(location.hash.substring(1))
  const playFromHash = allMusic.findIndex(
    (haystack) => haystack.SongName === startHash
  )
  if (playFromHash > -1) return playFromHash
  return Math.floor(Math.random() * allMusic.length + 1) // Otherwise play random song
}
let musicIndex = getStartSongIndex()
isMusicPaused = true

window.addEventListener("load", () => loadMusic(musicIndex))

const nowPlayingSong = () => allMusic[musicIndex]

const loadMusic = (indexNumb) => {
  if (indexNumb < 0) indexNumb = allMusic.length - 1

  if (indexNumb > allMusic.length - 1) indexNumb = 0

  musicIndex = indexNumb
  const song = allMusic[indexNumb]
  musicName.innerText = song.SongName
  if (song.ArtistLink) {
    musicName.href = song.ArtistLink
    musicName.title = "Original source"
  } else {
    musicName.removeAttribute("href")
    musicName.title = "A Music of a People Original"
  }

  musicArtist.innerText = song.Artist
  musicImg.src = `images/${song.CoverImage}.jpg`
  mainAudio.src = `songs/${song.Mp3Name}.mp3`
  updateFavorite(song)
  try {
    location.hash = encodeURIComponent(song.SongName)
  } catch (err) {
    console.error(err)
  }
}

const updateFavorite = (song) =>
  (favoriteMusicBtn.innerText = isFavorite(song)
    ? "favorite"
    : "thumbs_up_down")

function playMusic() {
  wrapper.classList.add("paused")
  playPauseBtn.querySelector("i").innerText = "pause"
  mainAudio.play()
}

function pauseMusic() {
  wrapper.classList.remove("paused")
  playPauseBtn.querySelector("i").innerText = "play_arrow"
  mainAudio.pause()
}

function prevMusic() {
  musicIndex--
  // todo: handle favorites play mode
  loadMusic(musicIndex)
  playMusic()
}

function nextMusic() {
  musicIndex++
  if (getCurrentPlayMode() === "stars")
    musicIndex = getNextFavorite(nowPlayingSong())

  loadMusic(musicIndex)
  playMusic()
}

const toggleMusic = () => {
  const isMusicPlay = wrapper.classList.contains("paused")
  //if isPlayMusic is true then call pauseMusic else call playMusic
  isMusicPlay ? pauseMusic() : playMusic()
}

const isFavorite = (song) =>
  favorites.some((haystack) => haystack.SongName === song.SongName)
const toggleFavorite = (song) => {
  if (isFavorite(song))
    favorites = favorites.filter(
      (someSong) => someSong.SongName !== song.SongName
    )
  else favorites.push(song)
  saveFavorites()
  updateFavorite(song)
}
const getNextFavorite = (song = nowPlayingSong()) => {
  if (!favorites.length)
    // If there are no favorites yet, play first song.
    return 0
  let nextSong
  if (!isFavorite(song))
    // If current song is not a favorite, play first favorite
    nextSong = favorites[0]
  // Play the next favorite after current
  else
    nextSong =
      favorites[
        favorites.findIndex((haystack) => haystack.SongName === song.SongName) +
          1
      ]
  if (!nextSong)
    // If this is the last favorite, play the first favorite
    nextSong = favorites[0]
  return (
    allMusic.findIndex((haystack) => haystack.SongName === nextSong.SongName) ||
    0
  ) // Now return the index from the catalog, or play the first song.
}
const saveFavorites = () => {
  try {
    localStorage.setItem(localStorageKeys.favorites, JSON.stringify(favorites))
  } catch (err) {
    console.error("Error saving favorites", err)
  }
}

playPauseBtn.addEventListener("click", () => toggleMusic())
prevBtn.addEventListener("click", () => prevMusic())
nextBtn.addEventListener("click", () => nextMusic())
favoriteMusicBtn.addEventListener("click", () =>
  toggleFavorite(nowPlayingSong())
)

Mousetrap.bind("space", () => toggleMusic())
Mousetrap.bind("left", () => prevMusic())
Mousetrap.bind("right", () => nextMusic())
Mousetrap.bind("f", () => toggleFavorite(nowPlayingSong()))
Mousetrap.bind("r", () => playRandomSong())

// update progress bar width according to music current time
mainAudio.addEventListener("timeupdate", (e) => {
  const currentTime = e.target.currentTime //getting playing song currentTime
  const duration = e.target.duration //getting playing song total duration
  let progressWidth = (currentTime / duration) * 100
  progressBar.style.width = `${progressWidth}%`

  let musicCurrentTime = wrapper.querySelector(".current-time"),
    musicDuartion = wrapper.querySelector(".max-duration")
  mainAudio.addEventListener("loadeddata", () => {
    // update song total duration
    let mainAdDuration = mainAudio.duration
    let totalMin = Math.floor(mainAdDuration / 60)
    let totalSec = Math.floor(mainAdDuration % 60)
    if (totalSec < 10) {
      //if sec is less than 10 then add 0 before it
      totalSec = `0${totalSec}`
    }
    musicDuartion.innerText = `${totalMin}:${totalSec}`
  })
  // update playing song current time
  let currentMin = Math.floor(currentTime / 60)
  let currentSec = Math.floor(currentTime % 60)
  if (currentSec < 10) {
    //if sec is less than 10 then add 0 before it
    currentSec = `0${currentSec}`
  }
  musicCurrentTime.innerText = `${currentMin}:${currentSec}`
})

// update playing song currentTime on according to the progress bar width
progressArea.addEventListener("click", (e) => {
  let progressWidth = progressArea.clientWidth //getting width of progress bar
  let clickedOffsetX = e.offsetX //getting offset x value
  let songDuration = mainAudio.duration //getting song total duration

  mainAudio.currentTime = (clickedOffsetX / progressWidth) * songDuration
  playMusic() //calling playMusic function
})

const repeatBtn = wrapper.querySelector("#repeat-plist")
const playModes = {
  repeat_one: "Playing one song on repeat",
  shuffle: "Playing all shuffled",
  repeat: "Playing all",
  stars: "Playing favorites only",
}
const savePlayMode = (playMode) => {
  try {
    localStorage.setItem(localStorageKeys.playMode, playMode)
  } catch (err) {
    console.error("Error saving play mode", err)
  }
}
const setPlayMode = (playMode) => {
  repeatBtn.innerText = playMode
  repeatBtn.setAttribute("title", playModes[playMode])
  savePlayMode(playMode)
}
const initPlayMode = () => {
  const playMode = localStorage.getItem(localStorageKeys.playMode)
  if (playMode) setPlayMode(playMode)
}
initPlayMode()
const getCurrentPlayMode = () => repeatBtn.innerText

//change loop, shuffle, repeat icon onclick
repeatBtn.addEventListener("click", () => {
  const modes = Object.keys(playModes)
  const index = modes.indexOf(getCurrentPlayMode())
  const nextPlayMode = modes[index + 1] || modes[0]
  setPlayMode(nextPlayMode)
})

const playRandomSong = () => {
  let randIndex = Math.floor(Math.random() * allMusic.length + 1) //genereting random index/numb with max range of array length
  do {
    randIndex = Math.floor(Math.random() * allMusic.length + 1)
  } while (musicIndex == randIndex) //this loop run until the next random number won't be the same of current musicIndex
  musicIndex = randIndex //passing randomIndex to musicIndex
  loadMusic(musicIndex)
  playMusic()
}

const endOfSong = () => {
  // we'll do according to the icon means if user has set icon to
  // loop song then we'll repeat the current song and will do accordingly
  let getText = getCurrentPlayMode() //getting this tag innerText
  switch (getText) {
    case "repeat":
      nextMusic() //calling nextMusic function
      break
    case "repeat_one":
      mainAudio.currentTime = 0 //setting audio current time to 0
      loadMusic(musicIndex) //calling loadMusic function with argument, in the argument there is a index of current song
      playMusic() //calling playMusic function
      break
    case "stars":
      musicIndex = getNextFavorite(nowPlayingSong())
      loadMusic(musicIndex)
      playMusic()
      break
    case "shuffle":
      playRandomSong()
      break
  }
}

//code for what to do after song ended
mainAudio.addEventListener("ended", () => endOfSong())
